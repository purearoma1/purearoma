<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PureAroma - Premium Scents</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --bg-color: #050505;
            --card-bg: #111;
            --text-color: #fff;
            --sale-red: #ff3333;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- UTILITY --- */
        .hidden { display: none !important; }
        .btn { cursor: pointer; font-weight: bold; text-transform: uppercase; border-radius: 5px; transition: 0.3s; border: none; }
        
        /* --- HEADER --- */
        header {
            position: relative; height: 450px;
            background-image: url('https://images.unsplash.com/photo-1615634260167-c8cdede054de?q=80&w=1600&auto=format&fit=crop'); 
            background-size: cover; background-position: center;
            border-bottom: 2px solid var(--neon-pink);
        }
        .header-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 10px;
        }
        h1 { font-family: 'Orbitron', sans-serif; font-size: 3.5rem; color: #fff; text-shadow: 0 0 10px #fff, 0 0 20px var(--neon-blue); margin-bottom: 10px; }
        .tagline { font-size: 1.2rem; }

        /* --- PROMO & CONTACT --- */
        .promo-strip { background: var(--neon-blue); color: #000; text-align: center; padding: 8px; font-weight: bold; font-size: 0.9rem; letter-spacing: 1px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        .contact-strip { background: #111; color: #ccc; text-align: center; padding: 5px; font-size: 0.8rem; border-bottom: 1px solid #333; }

        /* --- FEATURES --- */
        .features-section { padding: 40px 20px; text-align: center; background: #0a0a0a; border-bottom: 1px solid #222; }
        .section-title { font-family: 'Orbitron', sans-serif; font-size: 2rem; color: var(--neon-blue); text-align: center; margin-bottom: 30px; }
        .features-grid { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; }
        .feature-box { flex: 1; min-width: 280px; padding: 20px; background: #111; border: 1px solid #333; border-radius: 10px; }
        .feature-icon { font-size: 2rem; color: var(--neon-pink); margin-bottom: 10px; }

        /* --- PRODUCT GRID --- */
        .container { max-width: 1200px; margin: 40px auto; padding: 0 15px; }
        .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }

        .product-card {
            background: var(--card-bg); border: 1px solid #333; border-radius: 15px; padding: 15px;
            text-align: center; position: relative; transition: 0.3s; cursor: pointer;
        }
        .product-card:hover { border-color: var(--neon-blue); transform: translateY(-5px); }
        .sale-badge { position: absolute; top: 15px; right: 15px; background: var(--sale-red); color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 0.8rem; z-index: 5; }
        .product-image { width: 100%; height: 220px; object-fit: contain; background: #fff; border-radius: 10px; margin-bottom: 15px; }
        .product-title { font-family: 'Orbitron', sans-serif; font-size: 1.3rem; margin: 10px 0; }
        .old-price { text-decoration: line-through; color: #888; margin-right: 10px; }
        .new-price { font-size: 1.4rem; color: var(--neon-pink); font-weight: bold; }
        .view-btn { background: transparent; color: var(--neon-blue); border: 2px solid var(--neon-blue); padding: 10px; width: 100%; margin-top: 10px; font-family: 'Orbitron', sans-serif; }
        .view-btn:hover { background: var(--neon-blue); color: #000; }
        .rating-mini { font-size: 0.9rem; color: gold; margin-top: 5px; }

        /* --- PRODUCT DETAIL PAGE --- */
        #product-page { padding: 20px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.5s; }
        .back-btn { background: #333; color: white; padding: 10px 20px; display: inline-block; margin-bottom: 20px; text-decoration: none; border-radius: 5px; }
        .back-btn:hover { background: var(--neon-pink); }
        .detail-layout { display: flex; flex-wrap: wrap; gap: 40px; background: #111; padding: 30px; border-radius: 15px; border: 1px solid var(--neon-blue); }
        .detail-image-section { flex: 1; min-width: 300px; }
        .main-img-box { background: #fff; border-radius: 10px; padding: 20px; text-align: center; height: 450px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .detail-image { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .thumbnails { display: flex; gap: 10px; margin-top: 15px; justify-content: center; flex-wrap: wrap; }
        .thumb { width: 60px; height: 60px; object-fit: cover; border: 2px solid #333; border-radius: 5px; cursor: pointer; background: #fff; transition: 0.3s; }
        .thumb:hover { border-color: var(--neon-pink); transform: scale(1.1); }

        .detail-info { flex: 1; min-width: 300px; }
        .detail-title { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; color: var(--neon-blue); margin-top: 0; margin-bottom: 10px; }
        .detail-meta { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }
        .meta-tag { background: #222; border: 1px solid #444; padding: 5px 12px; border-radius: 50px; font-size: 0.85rem; color: #ccc; }
        .meta-tag i { color: gold; margin-right: 5px; }

        .detail-price-box { font-size: 2.2rem; color: var(--neon-pink); margin: 15px 0; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .detail-desc { color: #ccc; line-height: 1.8; margin-bottom: 20px; font-size: 1rem; text-align: justify; }
        
        .specs-box { background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .spec-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .spec-row:last-child { border: none; }
        .spec-label { color: #888; }
        .spec-value { color: #fff; font-weight: bold; }

        .qty-wrapper { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .qty-controls { display: flex; align-items: center; background: #000; border: 1px solid var(--neon-blue); border-radius: 5px; }
        .qty-btn { background: transparent; color: var(--neon-blue); border: none; padding: 10px 15px; font-size: 1.2rem; cursor: pointer; }
        .qty-display { padding: 0 15px; font-weight: bold; color: #fff; min-width: 30px; text-align: center; }

        .order-box { background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #aaa; margin-bottom: 5px; }
        .form-input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        .btn-whatsapp { background: #25D366; color: white; width: 100%; padding: 15px; margin-top: 10px; font-size: 1rem; }
        .btn-email { background: #EA4335; color: white; width: 100%; padding: 15px; margin-top: 10px; font-size: 1rem; }
        
        .bill-summary { background: #000; padding: 15px; border-radius: 5px; border: 1px solid #333; margin-bottom: 15px; font-size: 0.95rem; }
        .bill-row { display: flex; justify-content: space-between; margin-bottom: 8px; color: #ccc; }
        .bill-row.total { border-top: 1px solid #444; padding-top: 10px; margin-top: 10px; color: var(--neon-pink); font-weight: bold; font-size: 1.2rem; }
        .free-tag { color: var(--neon-blue); font-weight: bold; animation: pulse 1s infinite; }

        /* --- REVIEW SECTION --- */
        .reviews-wrapper { margin-top: 40px; border-top: 1px solid #333; padding-top: 30px; }
        .review-card { background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid var(--neon-pink); }
        .r-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .r-name { font-weight: bold; color: #fff; }
        .r-stars { color: gold; }
        .r-text { color: #ccc; font-size: 0.9rem; font-style: italic; }
        .review-form { background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; margin-top: 20px; }

        /* --- FOOTER & ADMIN --- */
        footer { background: #000; padding: 40px 20px; border-top: 2px solid var(--neon-pink); text-align: center; margin-top: 50px; }
        .return-btn, .admin-btn { background: transparent; border: 1px solid var(--sale-red); padding: 10px 20px; margin: 10px; color: #fff; cursor: pointer; }
        .admin-btn { border-color: var(--neon-blue); color: var(--neon-blue); }
        .admin-btn:hover { background: var(--neon-blue); color: #000; }

        /* --- MODALS --- */
        .modal { display: none; position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; padding: 10px; box-sizing: border-box; overflow-y: auto; }
        .modal-content { background: #111; border: 2px solid var(--sale-red); padding: 25px; border-radius: 15px; width: 100%; max-width: 500px; position: relative; margin: auto; }
        .close { position: absolute; top: 10px; right: 15px; color: #fff; font-size: 30px; cursor: pointer; }
        
        #adminModal .modal-content { border-color: var(--neon-blue); max-width: 600px; }
        
        /* Admin Dashboard Styles */
        .admin-list { max-height: 200px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #333; padding: 10px; }
        .admin-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding: 10px 0; }
        .admin-item div { color: white; }
        .admin-actions button { padding: 5px 10px; font-size: 0.8rem; margin-left: 5px; }
        .btn-edit { background: var(--neon-blue); border: none; cursor: pointer; border-radius: 3px; }
        .btn-del { background: var(--sale-red); color: white; border: none; cursor: pointer; border-radius: 3px; }

        #offline-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; flex-direction: column; justify-content: center; align-items: center; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 768px) { h1 { font-size: 2.2rem; } header { height: 350px; } .detail-title { font-size: 1.8rem; } .detail-layout { flex-direction: column; gap: 20px; } }
    </style>
</head>
<body>

    <div id="offline-screen">
        <i class="fas fa-wifi" style="font-size: 4rem; color: red; margin-bottom: 20px;"></i>
        <h2>NO INTERNET</h2>
        <p>Please connect to internet to use PureAroma.</p>
        <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px;">RETRY</button>
    </div>

    <div class="promo-strip">üéâ SPECIAL OFFER: BUY 2+ PRODUCTS & GET FREE DELIVERY! üéâ</div>
    <div class="contact-strip">Email: purearoma001@gmail.com | WhatsApp: 0315 6968247</div>

    <div id="home-view">
        <header>
            <div class="header-overlay">
                <h1>PureAroma</h1>
                <div class="tagline">Experience the Essence of Luxury</div>
            </div>
        </header>

        <div class="features-section">
            <h2 class="section-title">OUR PROMISE</h2>
            <div class="features-grid">
                <div class="feature-box"><i class="fas fa-truck feature-icon"></i><h3>Fast Delivery</h3><p>3-4 Days (Rs. 200)</p></div>
                <div class="feature-box"><i class="fas fa-undo-alt feature-icon"></i><h3>Easy Return</h3><p>7 Days Policy</p></div>
                <div class="feature-box"><i class="fas fa-gem feature-icon"></i><h3>Premium Quality</h3><p>Long Lasting Scent</p></div>
            </div>
        </div>

        <div class="container">
            <h2 class="section-title">FLASH SALE</h2>
            <div class="products" id="product-grid"></div>
        </div>
    </div>

    <div id="product-page" class="hidden">
        <button class="back-btn" onclick="showHome()"><i class="fas fa-arrow-left"></i> Back to Home</button>
        
        <div class="detail-layout">
            <div class="detail-image-section">
                <div class="main-img-box"><img id="detail-img" src="" alt="Perfume" class="detail-image"></div>
                <div class="thumbnails" id="thumbnail-container"></div>
            </div>

            <div class="detail-info">
                <h1 id="detail-title" class="detail-title"></h1>
                
                <div class="detail-meta">
                    <span class="meta-tag" id="detail-rating-box"></span>
                    <span class="meta-tag"><i class="far fa-clock"></i> <span id="detail-lasting"></span></span>
                </div>

                <div class="detail-price-box">
                    <span id="detail-old-price" style="text-decoration: line-through; color: #888; font-size: 1.2rem; margin-right: 10px;"></span>
                    <span id="detail-price"></span>
                </div>

                <div class="specs-box">
                    <div class="spec-row"><span class="spec-label">Notes:</span> <span class="spec-value" id="spec-notes"></span></div>
                    <div class="spec-row"><span class="spec-label">Best For:</span> <span class="spec-value" id="spec-best"></span></div>
                    <div class="spec-row"><span class="spec-label">Intensity:</span> <span class="spec-value" id="spec-intensity"></span></div>
                </div>

                <div id="detail-desc" class="detail-desc"></div>

                <div class="qty-wrapper">
                    <span class="qty-label" style="color:#fff;">Quantity:</span>
                    <div class="qty-controls">
                        <button class="qty-btn" onclick="changeQty(-1)">-</button>
                        <span class="qty-display" id="qty-count">1</span>
                        <button class="qty-btn" onclick="changeQty(1)">+</button>
                    </div>
                </div>

                <div class="order-box">
                    <h3 class="order-header">Complete Order</h3>
                    <div class="bill-summary">
                        <div class="bill-row"><span>Item Price:</span> <span id="bill-price"></span></div>
                        <div class="bill-row"><span>Quantity:</span> <span id="bill-qty"></span></div>
                        <div class="bill-row"><span>Delivery:</span> <span id="bill-delivery"></span></div>
                        <div class="bill-row total"><span>Grand Total:</span> <span id="bill-total"></span></div>
                    </div>
                    <div class="form-group"><label>Name</label><input type="text" id="order-name" class="form-input" placeholder="Full Name"></div>
                    <div class="form-group"><label>Phone</label><input type="tel" id="order-phone" class="form-input" placeholder="03xx-xxxxxxx"></div>
                    <div class="form-group"><label>Address</label><textarea id="order-address" class="form-input" rows="2" placeholder="Address"></textarea></div>
                    <button class="btn btn-whatsapp" onclick="placeOrder('whatsapp')"><i class="fab fa-whatsapp"></i> Order via WhatsApp</button>
                    <button class="btn btn-email" onclick="placeOrder('email')"><i class="fas fa-envelope"></i> Order via Email</button>
                </div>

                <div class="reviews-wrapper">
                    <h2 style="color:var(--neon-blue); font-family:'Orbitron';">Customer Reviews</h2>
                    <div id="reviews-list"></div>
                    
                    <div class="review-form">
                        <h3 style="color:#fff;">Write a Review</h3>
                        <div class="form-group"><input type="text" id="rev-name" class="form-input" placeholder="Your Name"></div>
                        <div class="form-group">
                            <select id="rev-rating" class="form-input">
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4/5)</option>
                            </select>
                        </div>
                        <div class="form-group"><textarea id="rev-text" class="form-input" placeholder="Your experience..."></textarea></div>
                        <button class="btn" style="background:var(--neon-pink); color:#fff; width:100%; padding:10px;" onclick="addReview()">Submit Review</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <h2 style="font-family: 'Orbitron'; color: white;">PureAroma</h2>
        <p style="color: #aaa;">Email: purearoma001@gmail.com</p>
        <button class="btn return-btn" onclick="document.getElementById('returnModal').style.display='flex'">Return / Exchange</button>
        <button class="btn admin-btn" onclick="openAdmin()">Admin Panel</button>
        <p style="margin-top: 30px; color: #555;">&copy; 2025 PureAroma. All Rights Reserved.</p>
    </footer>

    <div id="returnModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('returnModal').style.display='none'">&times;</span>
            <h2 style="color:var(--sale-red);">Return Request</h2>
            <div class="form-group"><label>Name</label><input type="text" id="r_name" class="form-input"></div>
            <div class="form-group"><label>Product Name</label><input type="text" id="r_prod" class="form-input"></div>
            <div class="form-group"><label>Reason</label><textarea id="r_reason" class="form-input"></textarea></div>
            <p style="color:red; font-size:0.8rem; border:1px solid red; padding:5px;">‚ö†Ô∏è Attach photos/videos in chat.</p>
            <button class="btn btn-whatsapp" onclick="submitReturn()">Send Request</button>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdmin()">&times;</span>
            <h2 style="color:var(--neon-blue);">Admin Dashboard</h2>
            
            <div style="color: #ccc; margin-bottom: 10px;">Existing Products:</div>
            <div id="admin-product-list" class="admin-list">
                </div>

            <hr style="border-color: #333; margin: 20px 0;">

            <h3 id="admin-form-title" style="color:white; margin-top:0;">Add / Edit Product</h3>
            <div class="form-group"><label>Product Name</label><input type="text" id="adm-name" class="form-input"></div>
            <div class="form-group"><label>Old Price (Rs)</label><input type="number" id="adm-old" class="form-input"></div>
            <div class="form-group"><label>New Price (Rs)</label><input type="number" id="adm-new" class="form-input"></div>
            
            <div class="form-group"><label>Lasting (e.g. 8 Hours)</label><input type="text" id="adm-lasting" class="form-input"></div>
            <div class="form-group"><label>Notes</label><input type="text" id="adm-notes" class="form-input"></div>
            <div class="form-group"><label>Best For</label><input type="text" id="adm-best" class="form-input"></div>
            <div class="form-group"><label>Intensity</label><input type="text" id="adm-intensity" class="form-input"></div>

            <div class="form-group"><label>Main Image (Upload New)</label><input type="file" id="adm-img" class="form-input" accept="image/*"></div>
            <div class="form-group"><label>Gallery URLs (Comma separated)</label><input type="text" id="adm-gallery" class="form-input" placeholder="https://..., https://..."></div>
            
            <div class="form-group"><label>Description</label><textarea id="adm-desc" class="form-input" rows="3"></textarea></div>
            
            <button class="btn" id="adm-save-btn" style="background:var(--neon-blue); width:100%; padding:10px;" onclick="saveProduct()">Add Product</button>
        </div>
    </div>

    <script>
        // --- BASE DATA ---
        let defaultProducts = [
            {
                id: 0,
                title: "Dior Sauvage",
                oldPrice: 4549,
                price: 3199,
                img: "https://fimgs.net/mdimg/perfume/375x500.31861.jpg",
                gallery: ["https://fimgs.net/mdimg/perfume/375x500.31861.jpg"],
                lasting: "8-10 Hours",
                notes: "Bergamot, Pepper, Amberwood",
                bestFor: "Daily / Office / Gym",
                intensity: "Strong",
                desc: `<p><strong>The Essence of Wild Nature</strong></p><p>Dior Sauvage is not just a perfume; it is a declaration of freedom.</p>`
            },
            {
                id: 1,
                title: "Creed Aventus",
                oldPrice: 7599,
                price: 4499,
                img: "https://fimgs.net/mdimg/perfume/375x500.9828.jpg",
                gallery: ["https://fimgs.net/mdimg/perfume/375x500.9828.jpg"],
                lasting: "10-12 Hours",
                notes: "Pineapple, Birch, Musk",
                bestFor: "Events / Dates",
                intensity: "Very Strong",
                desc: `<p><strong>The King of Fragrances</strong></p><p>Creed Aventus is the most legendary niche fragrance in the world.</p>`
            },
            {
                id: 2,
                title: "Royal Oud",
                oldPrice: 1800,
                price: 1449,
                img: "https://fimgs.net/mdimg/perfume/375x500.51816.jpg",
                gallery: ["https://fimgs.net/mdimg/perfume/375x500.51816.jpg"],
                lasting: "8+ Hours",
                notes: "Oud, Vanilla, Woods",
                bestFor: "Winter / Night",
                intensity: "Moderate",
                desc: `<p><strong>The Gold Standard</strong></p><p>Royal Oud is a fragrance that speaks the language of luxury.</p>`
            },
            {
                id: 3,
                title: "J. Janan",
                oldPrice: 4500,
                price: 2499,
                img: "https://www.junaidjamshed.com/media/catalog/product/j/a/janan_-1_1__2.jpg",
                gallery: ["https://www.junaidjamshed.com/media/catalog/product/j/a/janan_-1_1__2.jpg"],
                lasting: "6-8 Hours",
                notes: "Leather, Musk, Bergamot",
                bestFor: "Traditional / Evening",
                intensity: "Strong",
                desc: `<p><strong>The Soul of Pakistan</strong></p><p>J. Janan by Junaid Jamshed is a cultural icon.</p>`
            }
        ];

        let products = [];
        const dummyUsers = ["Ali Ahmed", "Zainab K.", "Hammad Raza", "Usman", "Sara Bilal"];
        const dummyComments = ["Simply amazing!", "Best perfume ever.", "Recommended.", "Original product.", "Will order again."];

        let reviews = {};
        let currentProduct = null;
        let currentQty = 1;
        let deliveryCost = 200;
        let editingProductId = null; // To track if we are editing

        // --- INIT ---
        window.onload = function() {
            checkInternet();
            
            // Load or Set Data
            const storedProds = localStorage.getItem('myProducts');
            if(storedProds) {
                products = JSON.parse(storedProds);
            } else {
                products = defaultProducts;
                // Add dummy stats for first load
                initDummyData();
                localStorage.setItem('myProducts', JSON.stringify(products));
            }

            // Load reviews
            const storedRevs = localStorage.getItem('myReviews');
            if(storedRevs) reviews = JSON.parse(storedRevs);
            else initReviewData(); // Fill if empty

            renderProducts();
        };

        function initDummyData() {
            products.forEach(p => {
                if(!p.rating) p.rating = (Math.random() * (5.0 - 4.2) + 4.2).toFixed(1);
                if(!p.reviewCount) p.reviewCount = Math.floor(Math.random() * 400) + 100;
            });
        }

        function initReviewData() {
            products.forEach(p => {
                reviews[p.id] = [];
                for(let i=0; i<3; i++) {
                    reviews[p.id].push({
                        name: dummyUsers[Math.floor(Math.random() * dummyUsers.length)],
                        rating: 5,
                        text: dummyComments[Math.floor(Math.random() * dummyComments.length)]
                    });
                }
            });
            localStorage.setItem('myReviews', JSON.stringify(reviews));
        }

        // --- ADMIN FUNCTIONS ---
        function openAdmin() {
            const pass = prompt("Enter Admin Password:");
            if(pass === "admin_upload") {
                renderAdminList();
                resetAdminForm();
                document.getElementById('adminModal').style.display = "flex";
            } else {
                alert("Wrong Password!");
            }
        }

        function closeAdmin() {
            document.getElementById('adminModal').style.display = "none";
        }

        function renderAdminList() {
            const list = document.getElementById('admin-product-list');
            list.innerHTML = "";
            products.forEach(p => {
                list.innerHTML += `
                    <div class="admin-item">
                        <div>${p.title} (Rs. ${p.price})</div>
                        <div class="admin-actions">
                            <button class="btn-edit" onclick="editProduct(${p.id})">Edit</button>
                            <button class="btn-del" onclick="deleteProduct(${p.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
        }

        function resetAdminForm() {
            editingProductId = null;
            document.getElementById('admin-form-title').innerText = "Add New Product";
            document.getElementById('adm-save-btn').innerText = "Add Product";
            
            // Clear fields
            document.getElementById('adm-name').value = "";
            document.getElementById('adm-old').value = "";
            document.getElementById('adm-new').value = "";
            document.getElementById('adm-lasting').value = "";
            document.getElementById('adm-notes').value = "";
            document.getElementById('adm-best').value = "";
            document.getElementById('adm-intensity').value = "";
            document.getElementById('adm-gallery').value = "";
            document.getElementById('adm-desc').value = "";
            document.getElementById('adm-img').value = "";
        }

        function editProduct(id) {
            const prod = products.find(p => p.id === id);
            if(!prod) return;

            editingProductId = id;
            document.getElementById('admin-form-title').innerText = "Edit Product: " + prod.title;
            document.getElementById('adm-save-btn').innerText = "Update Product";

            document.getElementById('adm-name').value = prod.title;
            document.getElementById('adm-old').value = prod.oldPrice;
            document.getElementById('adm-new').value = prod.price;
            document.getElementById('adm-lasting').value = prod.lasting;
            document.getElementById('adm-notes').value = prod.notes;
            document.getElementById('adm-best').value = prod.bestFor;
            document.getElementById('adm-intensity').value = prod.intensity;
            document.getElementById('adm-gallery').value = prod.gallery ? prod.gallery.join(', ') : "";
            document.getElementById('adm-desc').value = prod.desc.replace(/<[^>]*>?/gm, ''); // Strip HTML for edit
        }

        function deleteProduct(id) {
            if(confirm("Are you sure you want to delete this product?")) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('myProducts', JSON.stringify(products));
                renderProducts();
                renderAdminList();
            }
        }

        function saveProduct() {
            const name = document.getElementById('adm-name').value;
            const oldP = document.getElementById('adm-old').value;
            const newP = document.getElementById('adm-new').value;
            const lasting = document.getElementById('adm-lasting').value;
            const notes = document.getElementById('adm-notes').value;
            const best = document.getElementById('adm-best').value;
            const intensity = document.getElementById('adm-intensity').value;
            const galleryStr = document.getElementById('adm-gallery').value;
            const desc = document.getElementById('adm-desc').value;
            const fileInput = document.getElementById('adm-img');

            if(!name || !newP) { alert("Name and Price are required."); return; }

            const galleryArr = galleryStr ? galleryStr.split(',').map(s => s.trim()) : [];

            // Helper to finalize save
            const finalizeSave = (imgSrc) => {
                if(editingProductId !== null) {
                    // Update Existing
                    const index = products.findIndex(p => p.id === editingProductId);
                    if(index !== -1) {
                        products[index].title = name;
                        products[index].oldPrice = oldP;
                        products[index].price = newP;
                        products[index].lasting = lasting;
                        products[index].notes = notes;
                        products[index].bestFor = best;
                        products[index].intensity = intensity;
                        products[index].desc = `<p>${desc}</p>`;
                        if(imgSrc) products[index].img = imgSrc;
                        if(galleryArr.length > 0) products[index].gallery = galleryArr;
                        else if(!products[index].gallery) products[index].gallery = [products[index].img];
                    }
                } else {
                    // Add New
                    const newProd = {
                        id: Date.now(),
                        title: name,
                        oldPrice: oldP || newP,
                        price: newP,
                        img: imgSrc || "https://via.placeholder.com/300",
                        gallery: galleryArr.length > 0 ? galleryArr : [imgSrc],
                        lasting: lasting || "Standard",
                        notes: notes || "Mixed",
                        bestFor: best || "Any",
                        intensity: intensity || "Medium",
                        desc: `<p>${desc}</p>`,
                        rating: 5.0,
                        reviewCount: 1
                    };
                    products.push(newProd);
                }

                localStorage.setItem('myProducts', JSON.stringify(products));
                renderProducts();
                renderAdminList();
                resetAdminForm();
                alert(editingProductId !== null ? "Updated!" : "Added!");
            };

            // Handle Image
            if(fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { finalizeSave(e.target.result); };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                finalizeSave(null); // Keep old image if editing, or placeholder if new
            }
        }

        // --- RENDER ---
        function renderProducts() {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = "";
            products.forEach((prod, index) => {
                const discount = Math.round(((prod.oldPrice - prod.price) / prod.oldPrice) * 100);
                grid.innerHTML += `
                    <div class="product-card" onclick="showProduct(${prod.id})">
                        <div class="sale-badge">${discount}% OFF</div>
                        <img src="${prod.img}" class="product-image">
                        <div class="product-title">${prod.title}</div>
                        <div class="rating-mini">‚≠ê ${prod.rating} (${prod.reviewCount})</div>
                        <div><span class="old-price">Rs. ${prod.oldPrice}</span><span class="new-price">Rs. ${prod.price}</span></div>
                        <button class="btn view-btn">View Details</button>
                    </div>
                `;
            });
        }

        function showProduct(id) {
            currentProduct = products.find(p => p.id === id);
            currentQty = 1;
            updateBill();

            document.getElementById('detail-img').src = currentProduct.img;
            document.getElementById('detail-title').innerText = currentProduct.title;
            document.getElementById('detail-old-price').innerText = "Rs. " + currentProduct.oldPrice;
            document.getElementById('detail-price').innerText = "Rs. " + currentProduct.price;
            document.getElementById('detail-desc').innerHTML = currentProduct.desc;
            document.getElementById('spec-notes').innerText = currentProduct.notes;
            document.getElementById('spec-best').innerText = currentProduct.bestFor;
            document.getElementById('spec-intensity').innerText = currentProduct.intensity;
            document.getElementById('detail-rating-box').innerHTML = `<i class="fas fa-star" style="color:gold;"></i> <strong>${currentProduct.rating}/5.0</strong> (${currentProduct.reviewCount} Verified)`;
            document.getElementById('detail-lasting').innerText = currentProduct.lasting;

            // Gallery
            const thumbContainer = document.getElementById('thumbnail-container');
            thumbContainer.innerHTML = "";
            if(currentProduct.gallery && currentProduct.gallery.length > 0) {
                currentProduct.gallery.forEach(src => {
                    thumbContainer.innerHTML += `<img src="${src}" class="thumb" onclick="switchImage('${src}')">`;
                });
            } else {
                thumbContainer.innerHTML += `<img src="${currentProduct.img}" class="thumb" onclick="switchImage('${currentProduct.img}')">`;
            }

            renderReviews(currentProduct.id);

            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('product-page').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function switchImage(src) { document.getElementById('detail-img').src = src; }

        function renderReviews(prodId) {
            const list = document.getElementById('reviews-list');
            list.innerHTML = "";
            const prodReviews = reviews[prodId] || [];
            prodReviews.forEach(r => {
                const stars = "‚≠ê".repeat(r.rating);
                list.innerHTML += `<div class="review-card"><div class="r-header"><span class="r-name">${r.name}</span> <span class="r-stars">${stars}</span></div><div class="r-text">"${r.text}"</div></div>`;
            });
        }

        function addReview() {
            const name = document.getElementById('rev-name').value;
            const rating = document.getElementById('rev-rating').value;
            const text = document.getElementById('rev-text').value;
            if(!name || !text) { alert("Please fill details."); return; }
            const newRev = { name, rating, text };
            if(!reviews[currentProduct.id]) reviews[currentProduct.id] = [];
            reviews[currentProduct.id].push(newRev);
            localStorage.setItem('myReviews', JSON.stringify(reviews));
            renderReviews(currentProduct.id);
            document.getElementById('rev-name').value = ""; document.getElementById('rev-text').value = "";
        }

        function changeQty(delta) {
            currentQty += delta;
            if (currentQty < 1) currentQty = 1;
            updateBill();
        }

        function updateBill() {
            if(currentQty >= 2) deliveryCost = 0; else deliveryCost = 200;
            const itemTotal = currentProduct.price * currentQty;
            const grandTotal = itemTotal + deliveryCost;
            document.getElementById('qty-count').innerText = currentQty;
            document.getElementById('bill-price').innerText = "Rs. " + currentProduct.price;
            document.getElementById('bill-qty').innerText = currentQty;
            const delElement = document.getElementById('bill-delivery');
            if(deliveryCost === 0) delElement.innerHTML = "<span class='free-tag'>FREE</span>";
            else delElement.innerText = "Rs. 200";
            document.getElementById('bill-total').innerText = "Rs. " + grandTotal;
        }

        function showHome() {
            document.getElementById('product-page').classList.add('hidden');
            document.getElementById('home-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function placeOrder(method) {
            const name = document.getElementById('order-name').value;
            const phone = document.getElementById('order-phone').value;
            const address = document.getElementById('order-address').value;
            if(!name || !phone || !address) { alert("Please fill all details."); return; }
            const itemTotal = currentProduct.price * currentQty;
            const grandTotal = itemTotal + deliveryCost;
            let deliveryText = (deliveryCost === 0) ? "FREE (Buy 2+ Offer)" : "Rs. 200";
            const msg = `*NEW ORDER - PureAroma*\n------------------\nProduct: ${currentProduct.title}\nQty: ${currentQty}\nPrice/Unit: Rs. ${currentProduct.price}\nItem Total: Rs. ${itemTotal}\nDelivery: ${deliveryText}\n*GRAND TOTAL: Rs. ${grandTotal}*\n------------------\nName: ${name}\nPhone: ${phone}\nAddress: ${address}`;
            const encoded = encodeURIComponent(msg);
            if(method === 'whatsapp') window.location.href = `https://api.whatsapp.com/send?phone=923156968247&text=${encoded}`;
            else window.location.href = `mailto:purearoma001@gmail.com?subject=New Order&body=${encoded}`;
        }

        function submitReturn() {
            const name = document.getElementById('r_name').value;
            const prod = document.getElementById('r_prod').value;
            const reason = document.getElementById('r_reason').value;
            if(!name || !prod || !reason) { alert("Fill all fields."); return; }
            const msg = `*RETURN REQUEST*\nName: ${name}\nProduct: ${prod}\nReason: ${reason}\n\n(Evidence Attached)`;
            window.location.href = `https://api.whatsapp.com/send?phone=923156968247&text=${encodeURIComponent(msg)}`;
        }

        function checkInternet() {
            const screen = document.getElementById('offline-screen');
            if(navigator.onLine) screen.style.display = 'none';
            else screen.style.display = 'flex';
        }
        window.addEventListener('offline', checkInternet);
        window.addEventListener('online', checkInternet);
    </script>
</body>
</html>
